@model schliessanlagen_konfigurator.Models.Orders;
@using Microsoft.AspNetCore.Http;

@{
    ViewData["Title"] = $"Finisher/{Model.userKey}";

    int z = 0;
    int countFalse = 0;
    int d = 0;
}
@using (Html.BeginForm("SaveUserOrders", "Konfigurator", FormMethod.Post))
{ 
        
    @Html.HiddenFor(m => m.userKey)

    <input type="hidden" name="user" value="@Model.userKey" />
    <div id="FinisherPage">
  

    <h1>Schlüssel konfigurieren</h1>
    <p>
        Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur
        ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim
        justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt.
    </p>
    <div>

        @foreach (var item in ViewBag.Order)
        {
            z++;
            <div id="finisherItem">
                <div id="ItemCounterOrders">

                    <div id="counterKey">
                            <input onclick="minus(@z)" type="button" value="-" class="btn btn-success" />
                            <input type="text" style="border: none;max-width: 30px;" id="countKey-@z" readonly name="countKey" value="@item.CountKey" />
                            <input onclick="plus(@z)" type="button" value="+" class="btn btn-success" />
                    </div>

                </div>
                <div id="nameItem">
                        <input style="border: none;" name="key" value="@item.NameKey" />
                        <input style="border: none;" type="hidden" name="FurKey" value="@item.ForNameKey" /> 
                </div>

                <div id="numerKey">
                    <h3>Schlüssel Nr.@z </h3>
                </div>
                <div id="OpenValue">

                        @if (ViewBag.DorName.Count > ViewBag.CountKey)
                        {
                            @for (int i = 0; i < ViewBag.DorName.Count; i++)
                            {
                                @if (ViewBag.KeyValue[countFalse] == true)
                                {
                                    <input type="hidden" name="keyIsOpen" value="true" />
                                    <input name="TurName" style="border: none;max-width: 100px;" readonly type="text" id="@z-DorCount-@i" value="@ViewBag.DorName[i]" />
                                }
                                else
                                {
                                    <input type="hidden" name="keyIsOpen" value="false" />
                                }
                                countFalse++;
                            }
                            
                        }
                        else
                        {
                            @for (int i = 0; i < ViewBag.CountKey; i++)
                            {
                                @if (ViewBag.KeyValue[countFalse] == true)
                                {
                                    <input type="hidden" name="keyIsOpen" value="true" />
                                    <input name="TurName" style="border: none;max-width: 100px;" readonly type="text" id="@z-DorCount-@i" value="@ViewBag.DorName[i]" />
                                }
                                else
                                {
                                    <input type="hidden" name="keyIsOpen" value="false" />
                                }
                                countFalse++;
                            }
                        }
                   
                </div>
            </div>
        }
        <div>
        </div>
        <div id="FinisherAnderes">
                <a class="btn btn-danger" href="@Url.Action("ChangedKonfigPlan","Konfigurator",new{ userKey = @Model.userKey})">SCHLIESSPLAN BEARBEITEN</a>
        </div>
        <h1>Türen konfigurieren</h1>
        <p>
            Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur
            ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim
            justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt.
        </p>
    </div>
    <div>
        @if (ViewBag.Dopelzylinder != null)
        {
            int elemNum = 0;
         
            foreach (var item in ViewBag.Dopelzylinder)
            {
                    <input value="@item.Id" type="hidden" name="DopelItem" />
                <div id="ExelItem">
                    <div id="productImage">
                        <img decoding="async" style="border: 2px solid rgba(237,237,237,0.5);" src="@("~/image/"+@item.ImageName)" asp-append-version="true" width="400px" height="400px" />
                    </div>
                    <div id="productMenuInfo">
                        <div id="ProductNameUndCost">
                            <div>
                                    <input style="border: none;" readonly type="text" name="DopelName" value="@item.Name" />
                                    <input style="border: none;" type="hidden" name="NameSystem" value="@item.NameSystem" />
                            </div>
                        </div>
                        <div>
                            <select class="form-select">
                                <option>Doppelzylinder</option>
                            </select>
                        </div>
                        <div id="product_desciptions">
                            <h5>Zylinder Länge</h5>
                            <h5>Vifile Tür</h5>
                        </div>

                        <div id="Size-@d" class="SizeProduct">  
                            <div>
                                    <select class="form-select" name="DoppelAussen" id="Aussen" onchange="selectParamAussen(event.target.value,@d,@ViewBag.DAussen[elemNum])">
                                    <option style="display:none" selected>@ViewBag.DAussen[elemNum]</option>
                                    <option>Außenlänge (A)</option>
                                    @for (int i = 0; i < ViewBag.Dopelzylinderaussen.Count; i++)
                                    {
                                        <option id="OptionA">@ViewBag.Dopelzylinderaussen[i]</option>
                                    }
                                </select>
                            </div>
                            <div>
                                    <select class="form-select" name="DoppelIntern" id="Intern" onchange="selectParamIntern(event.target.value,@d)">
                                    <option style="display:none" selected>@ViewBag.DInter[elemNum]</option>
                                    <option>Innenlänge (B)</option>
                                    @for (int i = 0; i < ViewBag.DopelzylinderIntern.Count; i++)
                                    {
                                        <option id="OptionI">@ViewBag.DopelzylinderIntern[i]</option>
                                    }
                                </select>
                            </div>
                            <div style="gap: 10px;display: flex;margin-left: 50px;">
                                    <button type="button"  onclick="CylinderMinus(@d,@item.Cost)" class="btn btn-success">-</button>
                                    <input style="border: none;max-width: 30px;" id="countSchlusse-@d" type="text" readonly name="TurCounter" value="@ViewBag.CounterTur[@elemNum]" />
                                    <button type="button" onclick="CylinderPlus(@d,@item.Cost)" class="btn btn-success">+</button>
                            </div>
                        </div>


                        <div>
                            <h3>Weitere Optionen</h3>
                            <div>
                                @{
                                    int valueCount = 0;
                                }
                                @if (ViewBag.countOptionsQuery > 0)
                                {
                                    @for (int i = 0; i < ViewBag.optionsName.Count; i++)
                                    {
                                        if (@ViewBag.optionsName[i] == @ViewBag.DoppelOptionSelected[elemNum])
                                        {
                                                <input name="DopelOption" class="form-control" readonly type="text" value="&#10003; @ViewBag.optionsName[i]" style="color: green;margin-top: 5px;" />
                                        }
                                        else
                                        {
                                            <input class="form-control" style="margin-top: 5px;" readonly type="text" value="@ViewBag.optionsName[i]" />
                                        }

                                            <select style="margin-bottom: 10px;" name="DoppelOption" class="form-select" id="ProductDoppelOptionsSelector" onchange="selectParamOptions(event,@valueCount,@item.Id)">

                                            @for (int j = 0; j < ViewBag.countOptionsList[i]; j++)
                                            {
                                                if (@ViewBag.optionsName[i] == @ViewBag.DoppelOptionSelected[elemNum])
                                                {
                                                    if (@ViewBag.optionsValue[valueCount] == "Ja")
                                                    {
                                                        <option id="@valueCount" selected>@ViewBag.optionsValue[valueCount]</option>
                                                    }
                                                    else
                                                    {
                                                        <option id="@valueCount">@ViewBag.optionsValue[valueCount]</option>
                                                    }
                                                }
                                                else
                                                {
                                                    <option id="@valueCount">@ViewBag.optionsValue[valueCount]</option>
                                                }
                                                valueCount++;
                                           }

                                        </select>

                                    }
                                 }


                            </div>
                        </div>
                            @if (@ViewBag.DAussen[elemNum] < 80 && @ViewBag.DInter[elemNum] < 80)
                            {
                                <h6 style="color:red">Lieferzeit: 5 - 7 Werktage</h6>
                            }
                            else
                            {
                                <h6 style="color:red">Lieferzeit: ca 20 Werktage</h6>
                            }
                    </div>
                </div>
                elemNum++;
                d++;
            }
        }
        @if (ViewBag.KnayfZelinder != null)
        {
            
            int elemNum = 0;
            foreach (var item in ViewBag.KnayfZelinder)
            {
               <input type="hidden" name="Knayf" value="@item.Id" />
                <div id="ExelItem">
                    <div id="productImage">
                        <img decoding="async" style="border: 2px solid rgba(237,237,237,0.5);" src="@("~/image/"+@item.ImageName)" asp-append-version="true" width="400px" height="400px" />
                    </div>
                    <div id="productMenuInfo">
                        <div id="ProductNameUndCost">

                            <div>
                                    <input style="border: none;" readonly type="text" name="KnayfName" value="@item.Name" />
                                    <input style="border: none;" type="hidden" name="NameSystem" value="@item.NameSystem" />
                            </div>

                        </div>
                        <div>
                            <select class="form-select">
                                <option>KnayfZylinder</option>
                            </select>
                        </div>
                        <div id="product_desciptions">
                            <h5>Zylinder Länge</h5>
                            <h5>Vifile Tür</h5>
                        </div>

                            <div id="Size-@d" class="SizeProduct">
                            <div>
                                    <select class="form-select" name="KnayfAussen" id="Aussen" onchange="selectParamAussen(event.target.value,@d,@ViewBag.KAussen[elemNum])">
                                    <option style="display:none" selected>@ViewBag.KAussen[elemNum]</option>
                                    <option>Außenlänge (A)</option>
                                    @for (int i = 0; i < ViewBag.KnayfZelinderAussen.Count; i++)
                                    {
                                        <option id="OptionA">@ViewBag.KnayfZelinderAussen[i]</option>
                                    }
                                </select>
                            </div>
                            <div>
                                    <select class="form-select" name="KnayfIntern" id="Intern" onchange="selectParamIntern(event.target.value,@d,@ViewBag.KInter[elemNum])">
                                    <option style="display:none" selected>@ViewBag.KInter[elemNum]</option>
                                    <option>Innenlänge (B)</option>
                                    @for (int i = 0; i < ViewBag.KnayfZelinderIntern.Count; i++)
                                    {
                                            <option id="OptionI">@ViewBag.KnayfZelinderIntern[i]</option>
                                    }
                                </select>
                            </div>
                            <div style="gap: 10px;display: flex;margin-left: 50px;">
                                    <button type="button" onclick="CylinderMinus(@d,@item.Cost)" class="btn btn-success">-</button>
                                    <input style="border: none;max-width: 30px;" id="countSchlusse-@d" value="@ViewBag.CounterTurKnayf[@elemNum]" name="TurCounter" />
                                    <button type="button" onclick="CylinderPlus(@d,@item.Cost)" class="btn btn-success">+</button>
                            </div>
                        </div>        

                        <div>
                            <h3>Weitere Optionen</h3>
                            <div>
                                @{
                                    int valueCount = 0;
                                }
                                @if (ViewBag.countOptionsQueryKnayf > 0)
                                {
                                    @for (int i = 0; i < ViewBag.optionsNameKnayf.Count; i++)
                                    {
                                        if (@ViewBag.optionsNameKnayf[i] == @ViewBag.KnayfOptionSelected[elemNum])
                                        {
                                                <input class="form-control" name="KnayfOption" readonly type="text" value="&#10003; @ViewBag.optionsNameKnayf[i]" style="color: green;margin-top: 5px;" />
                                        }
                                        else
                                        {
                                            <input class="form-control" style="margin-top: 5px;" readonly type="text" value="@ViewBag.optionsNameKnayf[i]" />
                                        }

                                            <select style="margin-bottom: 10px;" name="KnayfOption" class="form-select" id="ProductOptionsSelector" onchange="selectParamOptions(event,@valueCount,@item.Id)">

                                            @for (int j = 0; j < ViewBag.countOptionsListKnayf[i]; j++)
                                            {
                                                if (@ViewBag.optionsNameKnayf[i] == @ViewBag.KnayfOptionSelected[elemNum])
                                                {
                                                    if (@ViewBag.optionsValueKnayf[valueCount] == "Ja")
                                                    {
                                                        <option id="@valueCount" selected>@ViewBag.optionsValueKnayf[valueCount]</option>
                                                    }
                                                    else
                                                    {
                                                        <option id="@valueCount">@ViewBag.optionsValueKnayf[valueCount]</option>
                                                    }
                                                }
                                                else
                                                {
                                                    <option id="@valueCount">@ViewBag.optionsValueKnayf[valueCount]</option>
                                                }
                                                valueCount++;
                                            }

                                        </select>
                                    }
                                } 

                            </div>
                        </div>
                            @if (@ViewBag.KAussen[elemNum] < 80 && @ViewBag.KInter[elemNum] < 80)
                            {
                                <h6 style="color:red">Lieferzeit: 5 - 7 Werktage</h6>
                            }
                            else
                            {
                                <h6 style="color:red">Lieferzeit: ca 20 Werktage</h6>
                            }
                    </div>
                </div>
                d++;
                elemNum++;
            }
           
        }
        @if (ViewBag.Halb != null)
        {
            int elemNum = 0;
           
            foreach (var item in ViewBag.Halb)
            {
                    <input type="hidden" name="Halb" value="@item.Id" />
                <div id="ExelItem">
                    <div id="productImage">
                        <img decoding="async" style="border: 2px solid rgba(237,237,237,0.5);" src="@("~/image/"+@item.ImageName)" asp-append-version="true" width="400px" height="400px" />
                    </div>
                    <div id="productMenuInfo">
                        <div id="ProductNameUndCost">

                            <div>
                                    <input style="border: none;" readonly type="text" name="HalbName" value="@item.Name" />
                                    <input style="border: none;" type="hidden" name="NameSystem" value="@item.NameSystem" />
                            </div>

                        </div>
                        <div>
                            <select class="form-select">
                                <option>Halbzylinder</option>
                            </select>
                        </div>
                        <div id="product_desciptions">
                            <h5>Zylinder Länge</h5>
                            <h5>Vifile Tür</h5>
                        </div>
                            <div id="Size-@d" class="SizeProduct">
                               
                            <div>
                                    <select name="HalbAussen" id="Aussen" class="form-select" onchange="selectParamAussen(event.target.value,@d,@ViewBag.HalbOrderAussen[elemNum])">
                                    <option style="display:none" selected>@ViewBag.HalbOrderAussen[elemNum]</option>
                                    <option>Außenlänge (A)</option>
                                    @for (int i = 0; i < ViewBag.AussenHalb.Count; i++)
                                    {
                                            <option id="OptionA">@ViewBag.AussenHalb[i]</option>
                                    }
                                </select>
                            </div>
                            <div style="gap: 10px;display: flex;margin-left: 50px;">
                                    <button type="button" onclick="CylinderMinus(@d,@item.Cost)" class="btn btn-success">-</button>
                                    <input style="border: none;max-width: 30px;" value="@ViewBag.CounterTurHalb[@elemNum]" name="TurCounter" id="countSchlusse-@d" />
                                    <button type="button" onclick="CylinderPlus(@d,@item.Cost)" class="btn btn-success">+</button>
                            </div>
                        </div>
                        <div>
                            <h3>Weitere Optionen</h3>
                            <div>
                                @{
                                    int valueCount = 0;
                                }
                               @if (ViewBag.countOptionsQueryHalb > 0)
                                {
                                    @for (int i = 0; i < ViewBag.HalbOptionsName.Count; i++)
                                    {

                                        if (@ViewBag.HalbOptionsName[i] == @ViewBag.HalbOptionSelected[elemNum])
                                        {
                                            <input class="form-control" name="HalbOption" readonly type="text" value="&#10003; @ViewBag.HalbOptionsName[i]" style="color: green;margin-top: 5px;" />
                                        }
                                        else
                                        {
                                            <input class="form-control" style="margin-top: 5px;" readonly type="text" value="@ViewBag.HalbOptionsName[i]" />
                                        }

                                            <select class="form-select" name="HalbOption" style="margin-bottom: 10px;" id="ProductOptionsSelector">

                                            @for (int j = 0; j < ViewBag.HalbOptionsValueCount[i]; j++)
                                            {
                                                if (@ViewBag.HalbOptionsName[i] == @ViewBag.HalbOptionSelected[elemNum])
                                                {
                                                    if (@ViewBag.HalbOptionsValue[valueCount] == "Ja")
                                                    {
                                                        <option id="@valueCount" selected>@ViewBag.optionsValue[valueCount]</option>
                                                    }
                                                    else
                                                    {
                                                        <option id="@valueCount">@ViewBag.HalbOptionsValue[valueCount]</option>
                                                    }
                                                }
                                                else
                                                {
                                                    <option id="@valueCount">@ViewBag.HalbOptionsValue[valueCount]</option>
                                                }
                                                valueCount++;
                                            }
                                        </select>
                                    }
                                } 
                            </div>
                        </div>
                            @if (@ViewBag.HalbOrderAussen[elemNum] < 75)
                            {
                                <h6 style="color:red">Lieferzeit: 5 - 7 Werktage</h6>
                            }
                            else
                            {
                                <h6 style="color:red">Lieferzeit: ca 20 Werktage</h6>
                            }
                    </div>
                       
                </div>
                elemNum++;
                d++;
            }
        }
        @if (ViewBag.HelbZ != null)
        {
            int elemNum = 0;
            foreach (var item in ViewBag.HelbZ)
            {
                    <input type="hidden" name="Helb" value="@item.Id" />
                <div id="ExelItem">
                    <div id="productImage">
                        <img decoding="async" style="border: 2px solid rgba(237,237,237,0.5);" src="@("~/image/"+@item.ImageName)" asp-append-version="true" width="400px" height="400px" />
                    </div>
                    <div id="productMenuInfo">
                        <div id="ProductNameUndCost">

                            <div>
                                    <input style="border: none;" readonly type="text" name="HelbName" value="@item.Name" />
                                    <input style="border: none;" type="hidden" name="NameSystem" value="@item.NameSystem" />
                            </div>

                        </div>
                        <div>
                            <select class="form-select">
                                <option>Hebelzylinder</option>
                            </select>
                        </div>
                        <div id="product_desciptions">
                            <h5>Zylinder Länge</h5>
                            <h5>Vifile Tür</h5>
                        </div>
                            <div id="@d" class="SizeProduct">
                            <div style="gap: 10px;display: flex;margin-left: 50px;">
                                    <button onclick="CylinderMinus(@d,@item.Cost)" type="button" class="btn btn-success">-</button>
                                    <input style="border: none;max-width: 30px;" name="TurCounter" value="@ViewBag.CounterTurHebel[@elemNum]" id="countSchlusse-@d" />
                                    <button onclick="CylinderPlus(@d,@item.Cost)" type="button" class="btn btn-success">+</button>
                            </div>
                        </div>
                        <div>
                            <h3>Weitere Optionen</h3>
                            <div>
                                @{
                                    int valueCount = 0;
                                }

                                @if (ViewBag.CountOptionsHebel > 0)
                                {
                                    @for (int i = 0; i < ViewBag.OptionHebelName.Count; i++)
                                    {
                                        if (@ViewBag.OptionHebelName[i] == @ViewBag.HebelOptionSelected[elemNum])
                                        {
                                                <input class="form-control" name="HebelOption" readonly type="text" value="&#10003; @ViewBag.OptionHebelName[i]" style="color: green;margin-top: 5px;" />
                                        }
                                        else
                                        {
                                            <input style="margin-top: 5px;" class="form-control" readonly type="text" value="@ViewBag.OptionHebelName[i]" />
                                        }

                                            <select class="form-select" name="HebelOption" style="margin-bottom: 10px;" id="ProductOptionsSelector">

                                            @for (int j = 0; j < ViewBag.CountValueHebel[i]; j++)
                                            {
                                                if ((@ViewBag.OptionHebelName[i] == @ViewBag.HebelOptionSelected[elemNum]))
                                                {
                                                    if (@ViewBag.ValueHebel[valueCount] == "Ja")
                                                    {
                                                        <option id="@valueCount" selected>@ViewBag.ValueHebel[valueCount]</option>
                                                    }
                                                    else
                                                    {
                                                        <option id="@valueCount">@ViewBag.ValueHebel[valueCount]</option>
                                                    }
                                                }
                                                else
                                                {
                                                    <option id="@valueCount">@ViewBag.ValueHebel[valueCount]</option>
                                                }
                                                valueCount++;
                                            }
                                        </select>
                                    }
                                } 
                            </div>
                        </div>
                    </div>

                </div>
                elemNum++;
                    d++;
                }
        }
        @if (ViewBag.Vorhanschlos != null)
        {
            int elemNum = 0;
            foreach (var item in ViewBag.Vorhanschlos)
            {
                    <input type="hidden" name="Vorhan" value="@item.Id" />
                <div id="ExelItem">
                    <div id="productImage">
                        <img decoding="async" style="border: 2px solid rgba(237,237,237,0.5);" src="@("~/image/"+@item.ImageName)" asp-append-version="true" width="400px" height="400px" />
                    </div>
                    <div id="productMenuInfo">
                        <div id="ProductNameUndCost">

                            <div>
                                    <input style="border: none;" readonly type="text" name="VorhanName" value="@item.Name" />
                                    <input style="border: none;" type="hidden" name="NameSystem" value="@item.NameSystem" />
                            </div>

                        </div>
                        <div>
                            <select class="form-select">
                                <option>Vorhangschloss</option>
                            </select>
                        </div>
                        <div id="product_desciptions">
                            <h5>Zylinder Länge</h5>
                            <h5>Vifile Tür</h5>
                        </div>
                            <div id="Size-@d" class="SizeProduct">
                            <div>
                                    <select class="form-select" name="VorhanAussen" id="Aussen" onchange="VorhanSchlus(event.target.value,@d,event.target.dataset.oldValue)">
                                    <option style="display:none" selected>@ViewBag.VorhanOrderAussen[elemNum]</option>
                                    <option>Außenlänge (A)</option>
                                    @for (int i = 0; i < ViewBag.VorhanSize.Count; i++)
                                    {
                                      <option id="OptionA">@ViewBag.VorhanSize[i]</option>
                                    }
                                </select>
                            </div>
                            <div style="gap: 10px;display: flex;margin-left: 50px;">
                                    <button type="button" onclick="CylinderMinus(@d,@item.Cost)" class="btn btn-success">-</button>
                                    <input name="TurCounter" style="border: none;max-width: 30px;" id="countSchlusse-@d" value="@ViewBag.CounterTurVorhan[@elemNum]" />
                                    <button type="button" onclick="CylinderPlus(@d,@item.Cost)" class="btn btn-success">+</button>
                            </div>
                        </div>
                        <div>
                            <h3>Weitere Optionen</h3>
                            <div>
                                @{
                                    int valueCount = 0;
                                }

                                @if (ViewBag.VorhanschlossCount > 0)
                                {

                                    @for (int i = 0; i < ViewBag.VorhanschlossOptionCount; i++)
                                    {
                                        if (@ViewBag.VorhanschlossOptionName[i] == @ViewBag.VorhanOptionSelected[elemNum])
                                        {
                                                <input class="form-control" name="VorhnaOption" readonly type="text" value="&#10003; @ViewBag.VorhanschlossOptionName[i]" style="color: green;margin-top: 5px;" />
                                        }
                                        else
                                        {
                                            <input type="text" style="margin-top: 5px;" class="form-control" readonly value="@ViewBag.VorhanschlossOptionName[i]" />
                                        }


                                            <select style="margin-bottom: 10px;" name="VorhnaOption" class="form-select" id="ProductOptionsSelector">

                                            @for (int j = 0; j < ViewBag.VorhanOptionCount[i]; j++)
                                            {
                                                if (@ViewBag.VorhanschlossOptionName[i] == @ViewBag.VorhanOptionSelected[elemNum])
                                                {
                                                    if (@ViewBag.VorhanValue[valueCount] == "Ja")
                                                    {
                                                        <option id="@valueCount" selected>@ViewBag.VorhanValue[valueCount]</option>
                                                    }
                                                    else
                                                    {
                                                        <option id="@valueCount">@ViewBag.VorhanValue[valueCount]</option>
                                                    }
                                                }
                                                else
                                                {
                                                    <option id="@valueCount">@ViewBag.VorhanValue[valueCount]</option>
                                                }

                                                valueCount++;
                                            }

                                        </select>
                                    }
                                }
                            </div> 
                        </div>
                            @if (@ViewBag.CounterTurVorhan[@elemNum] < 45)
                            {
                                <h6 style="color:red">Lieferzeit: 5 - 7 Werktage</h6>
                            }
                            else
                            {
                                <h6 style="color:red">Lieferzeit: ca 20 Werktage</h6>
                            }
                    </div>
                </div>
                elemNum++;
                    d++;
                }
        }
        @if (ViewBag.Aussenzylinder != null)
        {
            int elemNum = 0;
            foreach (var item in ViewBag.Aussenzylinder)
            {
                    <input type="hidden" name="Aussen"  value="@item.Id"/>
                <div id="ExelItem">
                    <div id="productImage">
                        <img decoding="async" style="border: 2px solid rgba(237,237,237,0.5);" src="@("~/image/"+@item.ImageName)" asp-append-version="true" width="400px" height="400px" />
                    </div>
                    <div id="productMenuInfo">
                        <div id="ProductNameUndCost">

                            <div>
                                    <input style="border: none;" readonly type="text" name="AussenName" value="@item.Name" />
                                    <input style="border: none;" type="hidden" name="NameSystem" value="@item.NameSystem" />
                            </div>

                        </div>
                        <div>
                            <select class="form-select">
                                <option>Aussenzylinder_Rundzylinder</option>
                            </select>
                        </div>
                        <div >
                            <h5>Zylinder Länge</h5>
                            <h5>Vifile Tür</h5>
                        </div>
                            <div id="@d" class="SizeProduct">
                                <button type="button" onclick="CylinderMinus(@d,@item.Cost)" class="btn btn-success">-</button>
                                <input style="border: none;max-width: 30px;" name="TurCounter" value="@ViewBag.CounterTurAussen[@elemNum]" id="countSchlusse-@d" />
                                <button type="button" onclick="CylinderPlus(@d,@item.Cost)" class="btn btn-success">+</button>
                        </div>
                        <div>
                            <h3>Weitere Optionen</h3>
                            <div>
                                @{
                                    int valueCount = 0;
                                }
                                @if (ViewBag.AussenCountOption > 0)
                                {
                                    @for (int i = 0; i < ViewBag.AussenName.Count; i++)
                                    {
                                        if (@ViewBag.AussenName[i] == @ViewBag.AussenOptionSelected[elemNum])
                                        {
                                                <input class="form-control" name="AussenOption" readonly type="text" value="&#10003; @ViewBag.AussenName[i]" style="color: green;margin-top: 5px;" />
                                        }
                                        else
                                        {
                                            <input class="form-control" style="margin-top: 5px;" readonly type="text" value="@ViewBag.AussenName[i]" />
                                        }

                                            <select style="margin-bottom: 10px;" name="AussenOption" class="form-select" id="ProductOptionsSelector" onchange="selectParamOptions(event,@valueCount,@item.Id)">

                                            @for (int j = 0; j < ViewBag.AussenValue[i]; j++)
                                            {
                                                if (@ViewBag.optionsName[i] == @ViewBag.DoppelOptionSelected[elemNum])
                                                {
                                                    if (@ViewBag.optionsValue[valueCount] == "Ja")
                                                    {
                                                        <option id="@valueCount" selected>@ViewBag.AussenValue[valueCount]</option>
                                                    }
                                                    else
                                                    {
                                                        <option id="@valueCount">@ViewBag.AussenValue[valueCount]</option>
                                                    }
                                                }
                                                else
                                                {
                                                    <option id="@valueCount">@ViewBag.AussenValue[valueCount]</option>
                                                }

                                                valueCount++;
                                            }
                                        </select>
                                    }
                                } 


                            </div>
                        </div>
                    </div>
                </div>
                elemNum++;
                    d++;
                }
        }
        <div id="FinisherAnderes">
            <input type="button"  onclick="goBack()" class="btn btn-danger" value="ANDERES SYSTEM WÄHLEN" />
        </div>
        <div id="orderCost">
                <input name="cost" readonly type="text" value="@ViewBag.Cost" id="cost" />
                <input name="Sum" id="costed" type="hidden" style="border:none;font-size:24px" value="@ViewBag.Cost" />
        </div>
       
        <div id="buttonActionFinishBlock">
            <div id="FinisherLeft">
                <button id="chekProduct" type="button" class="btn btn-dark"> <a href="@Url.Action("System_Auswählen", "Konfigurator")">ZURÜCK</a></button>
            </div>
            <div id="FinisherRight">
                    @if (User.IsInRole("client") || User.IsInRole("admin"))
                    {

                        <input id="chekProduct" type="submit" value="IN DEN WARENKORB" class="btn btn-danger" />
                    }
                    else
                    {
                        <a class="btn btn-danger" asp-area="Identity" asp-page="/Account/Register">IN DEN WARENKORB</a>
                    }
            </div>
        </div>
    </div>
</div>
} 
<script>

    let keyPrice = @Html.Raw(ViewBag.KeyCost);

    let AllPrice = document.getElementById("cost");

    let pris = document.getElementById("costed");
    
    pris.value = AllPrice.innerHTML;
    let NoOptionCost = @Html.Raw(@ViewBag.CostProducted);
    let ParamSum = parseFloat(AllPrice.innerHTML.replace(',', '.') - NoOptionCost);
    localStorage.setItem("cost", ParamSum);

    localStorage.sInnen = 0;
    localStorage.sAussen = 0;
    localStorage.options = 0;
    localStorage.keyCost = 0;

    let AussenCost = 0;
    let InternCost = 0;
    let OptionCost = 0;

    function plus(n) 
    {
        let counter = document.getElementById("countKey-" + n);
        let value = Number(counter.value);
        value++;
        counter.value = value;

        AllPrice.value = parseFloat(AllPrice.value) + keyPrice;
    }
    function minus(n) 
    {
        let counter = document.getElementById("countKey-" + n);
        let value = Number(counter.value);
        value--;
        counter.value = value;

        AllPrice.value = parseFloat(AllPrice.value) - keyPrice;
    }
    function CylinderPlus(n, cost) 
    {
        let counter = document.getElementById("countSchlusse-" + n);
        let value = Number(counter.value);
        let oldConter = Number(counter.value);

            value++;
            counter.value = value;

            AllPrice.value = parseFloat(AllPrice.value) +  cost;
    }
    function CylinderMinus(n, cost) 
    {
        let counter = document.getElementById("countSchlusse-" + n);
        let value = Number(counter.value);
        let oldConter = Number(counter.value);
            value--;
            counter.value = value;

             AllPrice.value = parseFloat(AllPrice.value) - cost;
    }

    localStorage.OldVorhan = 0;
    
    let oldVorhan = 0;

    function VorhanSchlus(value, idBlock, oldSize) 
    {
        let VorhanSizeCost = @Html.Raw(@ViewBag.VorhanschlosSizeCostedJson);

        let VorhanSize = @Html.Raw(@ViewBag.VorhanschlosSizeJson);

        let BlockTur = document.getElementById("Size-" + idBlock);
        let Aussen = BlockTur.querySelector("#Aussen");
        let Aitems = Aussen.querySelectorAll("#OptionA");
       
        let iteration = 0;

        oldSize = oldVorhan;

        Aitems.forEach(function (items) 
        {

            let ItemValue = parseFloat(items.innerHTML);
            let ItemValueOld = Number(oldSize);
           
            if (value > ItemValueOld) 
            {
                if (ItemValue == value) 
                {
                    localStorage.sAussen =+ VorhanSizeCost[iteration];
                    let a = Number(localStorage.sInnen);
                    let b = Number(localStorage.sAussen);
                    let c = Number(localStorage.options);
                    let d = Number(localStorage.DopItem);

                    let sum =  a + b + c + d;

                    localStorage.OldVorhan = ItemValue;
                    
                    AllPrice.innerHTML = NoOptionCost + sum;
                }
                else 
                {
                    iteration++;
                }
                return;
            }

            else (ItemValue > value) 
            {
                if (ItemValue == ItemValueOld) 
                {
                    localStorage.sAussen = - (VorhanSizeCost[iteration] - VorhanSizeCost[iteration - 1]);
                    let a = Number(localStorage.sInnen);
                    let b = Number(localStorage.sAussen);
                    let c = Number(localStorage.options);
                    let d = Number(localStorage.DopItem);

                    let sum = parseFloat(localStorage.getItem("cost").replace(',', '.')) + a + b + c + d;
 
                    AllPrice.innerHTML = NoOptionCost + sum;
                    return;
                }
                else 
                {
                    iteration++;
                }
               
            }
           
        });

    }
    let countOldStatus = 0;

 

    function ValueWithHistory(initialValue) 
    {
        this.value = initialValue;
        this.oldValue = initialValue; // Инициализация старого значения

        // Метод для установки нового значения и сохранения старого
        this.setValue = function (newValue) 
        {
            this.oldValue = this.value; // Сохранение текущего значения в старое
            this.value = newValue; // Установка нового значения
        };
    }

    function selectParamAussen(value, idBlock, oldValue) 
    {
   
        let iterations = 0;
        let serchedItem = 0;

        let BlockTur = document.getElementById("Size-"+idBlock);
        let Aussen = BlockTur.querySelector("#Aussen");
        let Aitems = Aussen.querySelectorAll("#OptionA");

        if (valuef.oldValue === undefined) 
        {
             var valuef = new ValueWithHistory(oldValue);
        }

        let num = Number(value);
        valuef.setValue(num);

        console.log(valuef.value);
        console.log(valuef.oldValue);

        Aitems.forEach(function (items) 
        {
            let ItemValue = Number(items.innerHTML);

            let ItemValueOld = Number(value.oldValue);

            if (serchedItem == 1) 
            {
               
                return;
            }
            else 
            {
                if ((value > 31 || value > 30) && (value > ItemValueOld)) 
                {
                    if (ItemValue == value) 
                    {
                        iterations++;
                        serchedItem++;
                        countOldStatus++;
                        return;
                    }
                    if (ItemValue > ItemValueOld) 
                    {
                        iterations++;
                    }
                    
                }
               
                if (ItemValueOld > value) 
                {
                    if (ItemValue == ItemValueOld) 
                    {
                        iterations++;
                        serchedItem++;
                        return;
                    }
                    if (ItemValue > value) 
                    {
                        AussenCost =  AussenCost -5;
                    }
                }

            }

        });

        for (let i = 0; i < iterations; i++) 
        {
            AussenCost = AussenCost + 5;
        }

        localStorage.sAussen = AussenCost;
        let a = Number(localStorage.sInnen);
        let b = Number(localStorage.sAussen);
        let c = Number(localStorage.options);
        let d = Number(localStorage.DopItem);

        let sum = parseFloat(localStorage.getItem("cost").replace(',', '.')) + a + b + c + d;
        
        AllPrice.innerHTML = NoOptionCost + sum;
        iterations = 0;
        serchedItem = 0;
    }
    function selectParamIntern(value, idBlock, oldValue) 
    {
        let Iiterations = 0;
        let IserchedItem = 0;

        let BlockTur = document.getElementById("Size-" + idBlock);

        let Intern = BlockTur.querySelector("#Intern");

        let Iitems = Intern.querySelectorAll("#OptionI");

        Iitems.forEach(function (items) 
        {
            let ItemValue = Number(items.innerHTML);

            let ItemValueOld = Number(oldValue);

            if (IserchedItem == 1) 
            {
                return;
            }
            else 
            {
                if ((value > 31 || value > 30) && (value > ItemValueOld)) 
                {
                    if (ItemValue == value) 
                    {
                        InternCost = InternCost + 5;
                        IserchedItem++;
                        return;
                    }
                    if (ItemValue > ItemValueOld) 
                    {
                        InternCost = InternCost + 5;
                    }

                }
                if (ItemValueOld > value && ItemValue <= ItemValueOld) 
                {
                    if (ItemValue == ItemValueOld) 
                    {
                        IserchedItem++;
                        return;
                    }
                   
                        InternCost = InternCost - 5;
                }


            }

        });


        localStorage.sInnen = InternCost;

        let a = Number(localStorage.sInnen);
        let b = Number(localStorage.sAussen);
        let c = Number(localStorage.options);
        let d = Number(localStorage.DopItem);

        let sum = parseFloat(localStorage.getItem("cost").replace(',', '.')) + a + b + c + d;

        AllPrice.innerHTML = NoOptionCost + sum;
        Iiterations = 0;
        IserchedItem = 0;
    }
    function goBack() {
        window.history.back();
    }
    // function selectParamOptions(event, count, idBlock) 
    // {
    //     var selectedOptionId = event.target.options[event.target.selectedIndex].id;
    //     OptionCost = OptionPrice[selectedOptionId];
    //     localStorage.options = OptionCost;
    //     let a = Number(localStorage.sInnen);
    //     let b = Number(localStorage.sAussen);
    //     let c = Number(localStorage.options);

    //     let sum = parseFloat(localStorage.getItem("cost").replace(',', '.')) + a + b + c;
    //     AllPrice.innerHTML = String(sum);

    //     OptionCost = 0;
    //     console.log(OptionPrice[selectedOptionId]);
    // }

</script>
