@model schliessanlagen_konfigurator.Models.Orders;
@using Microsoft.AspNetCore.Http;

@{
    ViewData["Title"] = "Konfigurator";
}
@if (TempData["AlertMessage"] != null)
{
    <script>
        alert("@TempData["AlertMessage"]");
    </script>
}
<div>
    <div id="konfigMenu">
        <button type="button" class="btn btn-danger">1. Schließplan erstellen</button>
        <button type="button" class="btn btn-secondary"><a href="@Url.Action("System_Auswählen","Konfigurator",new{ userName = @ViewBag.UserNameItem} )">2. System auswählen</a></button>
        <button type="button" class="btn btn-secondary">3. Parameter einstellen</button>
    </div>
    <form asp-action="SaveOrder" enctype="multipart/form-data" asp-controller="Konfigurator">
  
        @Html.HiddenFor(m => m.userKey)

        <input type="hidden" value="@ViewBag.UserNameItem" name="userName" />
        <input name="ItemCount" type="hidden" id="itemcountOptions" />

    <div id="InformBar">
        <div id="blockSclussel" >
            <div id="sclusselInfo">
                <div id="schlussel">
                    <h3>Schlüssel</h3>
                </div>
               
                <div id="schlussel2">
                    <h4>Schlüssel hinzufügen</h4>
                </div>
                
                <div>
                        <input id="removeButton" type="button" value="-">
                        <input id="addButton" type="button" value="+">
                </div>
            </div>
            <div id="itemKeyBlock">
                <div  class="TexCount">
                    <h6>1</h6>
                    <div id="TexInputKey">
                            <input id="inputS" name="NameKey" placeholder="Name des Schlüssels" type="text" />
                    </div>
                    <div>
                            <input id="inputCount" name="CountKey" value="1" type="text" />
                    </div>
                </div>
             
            </div>
        </div>
        <div>
            <div id="sclusselInfo2">
                <div id="schlussel">
                    <h3>Türen (Zugänge)</h3>
                </div>

                <div id="schlussel3">
                    <h4>Tür hinzufügen</h4>
                </div>

                <div>
                    <input id="removeButtonTur" type="button" value="-">
                    <input id="addButtonTur" type="button" value="+">
                </div>
            </div>
            <div>
                <div id="turInfo">
                        <div id="BlockTur-1">
                        <div class="TexCountTur">
                            <div id="ItemTur">
                                <div>
                                    <h6 id="counterTur">1</h6>
                                </div>

                                            <div>
                                                <input id="inputTur" name="Turname" placeholder="Name der Tür" />
                                            </div>
                                   
                                <div>
                                        <input id="infoButten" type='button' value="i" />
                                </div>
                                   
                            </div>
                                <details>
                                 <summary>  </summary>
                                    <div id="SelectTurItem">
                                        <input id="TypeSelectTurItem" name="Ssl" placeholder="Ssl" />
                                    </div>
                                <div id="SelectTurItem">
                                        <select id="TypeSelectTurItem" onchange="selectParam(event.target.value,1)" name="ZylinderId">
                                    @foreach (var list in ViewBag.Zylinder_Typ)
                                    {
                                        <option>@list.nameType</option>
                                    }
                                </select>
                            </div>
                                   
                            <div id="SelectTurItem">
                                    <select id="TypeSelectTurItem"  class="aussen" name="aussen">
                                    <option>Außenlänge</option>
                                     @foreach (var list in ViewBag.DoppelAussen)
                                    {
                                        <option id="OptionA">@list</option>
                                    }
                                </select>

                            </div>
                            <div id="SelectTurItem">
                                        <select id="TypeSelectTurItem" class="Innen" name="innen">
                                    <option>Innenlänge</option>
                                    @foreach (var list in ViewBag.DoppelIntern)
                                    {
                                       <option id="OptionI">@list</option>
                                    }
                                </select>
                            </div>
                           
                            <div id="SelectTurItem">
                               <select id="TypeSelectTurItem" class="Option" name="Options">
                                    <option>Options</option>
                                    @foreach (var list in ViewBag.OptionsName)
                                    {
                                       <option id="OptionO">@list</option>
                                    }
                                </select>
                            </div>
                                </details>
                        </div>
                    </div>
                <div id="InfoValue">
                            <div class="horizontal" id="1horizontal">
                                <div class="checkboxContainer">
                                    <input type="checkbox" style="" id="1checkbox1">
                                    <input type="hidden" name="IsOppen" value="false" id="I1checkbox1">
                                </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
     
        <input type="submit" class="btn btn-success" id="input" value="Weiter" />
    </form>
</div>
<script>

   let blockCount = 1;
        
   let blockTur = 1;

    let OptionDoppel = @Html.Raw(ViewBag.JsonDoppelOption);
    let OptionKnayf = @Html.Raw(ViewBag.JsonKnayf);
    let OptionHebel = @Html.Raw(ViewBag.JsonHebel);
    let OptionHalb = @Html.Raw(ViewBag.JsonHabl);
    let OptionVorhan =@Html.Raw(ViewBag.JsonVorhan);
    let OptionAussen = @Html.Raw(ViewBag.JsonAussen);

    let DoppelAussenSize = @Html.Raw(ViewBag.SizeDoppelAussen);
    let DoppelInternSize = @Html.Raw(ViewBag.SizeDoppelIntern);

    let KnayfAussenSize = @Html.Raw(ViewBag.SizeKnayfAussen);
    let KnayfInternSize = @Html.Raw(ViewBag.SizeKnayfIntern);
    
    let HalbSize = @Html.Raw(ViewBag.SizeHalb);

    let VorhanSize = @Html.Raw(ViewBag.SizeVorhan);

    var data = JSON.parse(localStorage.getItem(`${blockTur}checkbox${blockCount}`));

    

    function selectParam(value,turNumber) 
    {

        let BlockTur = document.querySelector(`#BlockTur-${turNumber}`);

        let Aussen = BlockTur.querySelector(".aussen");
        let Intern = BlockTur.querySelector(".Innen");
        let Option = BlockTur.querySelector(".Option");
        
        let Aitems = Aussen.querySelectorAll("#OptionA");
        let Iitems = Intern.querySelectorAll("#OptionI");
        let Oitems = Option.querySelectorAll("#OptionO");

        console.log(Aitems);

        Aitems.forEach(function (items) 
        {
            items.parentNode.removeChild(items);
        });

        Iitems.forEach(function (items) 
        {
            items.parentNode.removeChild(items);
        });

        Oitems.forEach(function (items) 
        {
            items.parentNode.removeChild(items);
        });

        if (value == "Profil-Doppelzylinder") 
        {
            for (let i = 0; i < DoppelAussenSize.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionA";
                option.innerHTML = DoppelAussenSize[i];
                option.innerText = DoppelAussenSize[i];
                Aussen.appendChild(option);
            }
            for (let i = 0; i < DoppelInternSize.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionI";
                option.innerHTML = DoppelInternSize[i];
                option.innerText = DoppelInternSize[i];
                Intern.appendChild(option);
            }
            for (let i = 0; i < OptionDoppel.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionO";
                option.innerHTML = OptionDoppel[i];
                option.innerText = OptionDoppel[i];
                Option.appendChild(option);
            }
        }
        if (value == "Profil-Halbzylinder") 
        {
            for (let i = 0; i < HalbSize.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionA";
                option.innerHTML = HalbSize[i];
                option.innerText = HalbSize[i];
                Aussen.appendChild(option);
            }
            for (let i = 0; i < OptionHalb.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionO";
                option.innerHTML = OptionHalb[i];
                option.innerText = OptionHalb[i];
                Option.appendChild(option);
            }
        }
        if (value == "Profil-Knaufzylinder") 
        {
            for (let i = 0; i < KnayfAussenSize.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionA";
                option.innerHTML = KnayfAussenSize[i];
                option.innerText = KnayfAussenSize[i];
                Aussen.appendChild(option);
            }
            for (let i = 0; i < KnayfInternSize.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionI";
                option.innerHTML = KnayfInternSize[i];
                option.innerText = KnayfInternSize[i];
                Intern.appendChild(option);
            }
            for (let i = 0; i < OptionKnayf.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionO";
                option.innerHTML = OptionKnayf[i];
                option.innerText = OptionKnayf[i];
                Option.appendChild(option);
            }
        }
        if (value == "Hebelzylinder") 
        {
            for (let i = 0; i < OptionHebel.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionO";
                option.innerHTML = OptionHebel[i];
                option.innerText = OptionHebel[i];
                Option.appendChild(option);
            }
        }
        if (value == "Vorhangschloss") 
        {
            for (let i = 0; i < VorhanSize.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionA";
                option.innerHTML = VorhanSize[i];
                option.innerText = VorhanSize[i];
                Aussen.appendChild(option);
            }
            for (let i = 0; i < OptionVorhan.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionO";
                option.innerHTML = OptionVorhan[i];
                option.innerText = OptionVorhan[i];
                Option.appendChild(option);
            }
        }
        if (value == "Aussenzylinder_Rundzylinder") 
        {
            for (let i = 0; i < OptionAussen.length; i++) 
            {
                let option = document.createElement("option");
                option.id = "OptionO";
                option.innerHTML = OptionAussen[i];
                option.innerText = OptionAussen[i];
                Option.appendChild(option);
            }
        }
        console.log(value);
        console.log(turNumber);
    }

    function createCustomCheckbox(id) 
    {
        
        var checkbox = document.getElementById(id);
        var checkboxValue = false;

        if (!localStorage.getItem(id)) 
        {
            localStorage.setItem(id, 'false');
        }
     
        var savedValue = localStorage.getItem(id);

        if (savedValue !== null) 
        {
            console.log(checkbox);
            checkbox.checked = (savedValue === 'true'); 
            checkboxValue = checkbox.checked;

        }

        checkbox.addEventListener('change', function () 
        {
         
            localStorage.setItem(id, this.checked);
           
            checkboxValue = this.checked;

            console.log(checkbox);
            console.log(checkboxValue);

            let switches = document.getElementById(`I${id}`);
            console.log(switches);
            if (switches !== null)
                switches.value = String(this.checked);

        });
    }

    function foo() {
        localStorage.clear();
        createCustomCheckbox(`${blockTur}checkbox${blockCount}`);
    }

    window.onload = foo()

    function removeBlockTur() 
    {
                let blockToRemove = document.getElementById('BlockTur-' + blockTur);
                    
                if (blockToRemove) 
                {
                       blockToRemove.remove();

                       let Horizontal = document.getElementById(`${blockTur}horizontal`);
                            
                       Horizontal.remove();

                       blockTur--;
                }
    }

        function addBlockTur() {
        blockTur++;

        // Создаем новый блок
        let newBlock = document.createElement('div');
        newBlock.id = 'BlockTur-' + blockTur;
        newBlock.innerHTML = `  <div class="TexCountTur">
                                <div id="ItemTur">
                                    <div>
                                       <h6 id="counterTur">${blockTur}</h6>
                                    </div>

                                    <div>
                                            <input id="inputTur" name="Turname" placeholder="Name der Tür" />
                                    </div>

                                    <div>
                                     <input id="infoButten" type='button' value="i"/>
                                    </div>
                                </div>
                                      <details>
                                        <summary>  </summary>
                                             <div id ="SelectTurItem">
                                                      <input id="TypeSelectTurItem" name="Ssl" placeholder="Ssl" />
                                            </div>
                                <div id="SelectTurItem">
                                    <select id="TypeSelectTurItem" onchange="selectParam(event.target.value,${blockTur})" name="ZylinderId">
                                    @foreach (var list in ViewBag.Zylinder_Typ)
                                    {
                                      <option>@list.nameType</option>
                                    }
                                    </select>
                                </div>
                                     
                                <div id="SelectTurItem">
                                            <select id="TypeSelectTurItem" class="aussen" name="aussen">
                                        <option>Außenlänge</option>
                                        @foreach (var list in ViewBag.DoppelAussen)
                                        {
                                          <option id="OptionA">@list</option>
                                        }
                                    </select>
                                </div>
                                <div id="SelectTurItem">
                                            <select id="TypeSelectTurItem" class="Innen" name="innen">
                                           <option>Innenlänge</option>
                                         @foreach (var list in ViewBag.DoppelIntern)
                                         {
                                               <option id="OptionI">@list</option>
                                         }
                                    </select>
                                </div>
                               
                                <div id="SelectTurItem">
                                                 <select id="TypeSelectTurItem" class="Option" name="Options">
                                        <option>Options</option>
                                         @foreach (var list in ViewBag.OptionsName)
                                         {
                                             <option id="OptionO">@list</option>
                                         }
                                    </select>
                                </div>
                            </div>
                                     </details>
                `;

            document.getElementById('BlockTur-1').appendChild(newBlock);

            let horizont = document.createElement('div');
            horizont.id = `${blockTur}horizontal`;
            horizont.classList.add('horizontal');

            for (let i = 1; i <= blockCount; i++) 
            {

                let newBlockTur = document.createElement('div');
               
                newBlockTur.innerHTML = ` <input type="checkbox" id=${blockTur}checkbox${i}>
                <input type="hidden" name="IsOppen" value="false" id="I${blockTur}checkbox${i}">`;

                newBlockTur.id = `${blockTur}.checkboxContainer${i}`;

                newBlockTur.classList.add('checkboxContainer');

                horizont.appendChild(newBlockTur);

                document.getElementById('InfoValue').appendChild(horizont);

                createCustomCheckbox(`${blockTur}checkbox${i}`);
            }
    }
        function removeBlock() 
        {
            let blockToRemove = document.getElementById('TexCount-' + blockCount);
        
            if (blockToRemove) 
            {
                blockToRemove.remove();
                if (blockTur > 1) 
                {
                    for (let f = 1; f <= blockTur;) 
                    {
                            let blockToRemoveTurValue = document.getElementById(`${f}.checkboxContainer${blockCount}`);
                            blockToRemoveTurValue.remove();
  
                        f++;
 
                    }
                       
                }

                    else 
                    {
                        let blockToRemoveTurValue = document.getElementById(`${blockTur}.checkboxContainer${blockCount}`);
                        blockToRemoveTurValue.remove();
                    }

            blockCount--;
            }
              
        }

        // Функция для добавления блока
    function addBlock() 
    {
        blockCount++;
    
        let item = document.getElementById('itemcountOptions');
        item.value = blockCount;
        // Создаем новый блок
        let newBlock = document.createElement('div');
        newBlock.id = 'TexCount-' + blockCount;
        newBlock.innerHTML = `
                                    <div  class="TexCount">
                         <h6>${blockCount}</h6>
                            <div id="TexInputKey">
                                    <input id="inputS" name="NameKey" placeholder="Name des Schlüssels" type="text" />
                            </div>
                            <div>
                                     <input id="inputCount" name="CountKey" value="1" type="text" />
                            </div>
                        </div>

            `;
        document.getElementById('itemKeyBlock').appendChild(newBlock);
      
        let horizont = document.getElementById(`${blockTur}horizontal`);

        for (let i = 1; i <= blockTur; i++) 
        {
          
            let newBlockTur = document.createElement('div');

            newBlockTur.innerHTML = ` <input type="checkbox" id=${i}checkbox${blockCount}>
                                    <input type="hidden" name="IsOppen" value="false" id="I${i}checkbox${blockCount}">`;

            newBlockTur.id = `${i}.checkboxContainer${blockCount}`;

            newBlockTur.classList.add('checkboxContainer');

            document.getElementById(`${i}horizontal`).appendChild(newBlockTur);

            document.getElementById('InfoValue').appendChild(horizont);

            createCustomCheckbox(`${i}checkbox${blockCount}`);
        }

    }

        document.getElementById('removeButton').addEventListener('click', removeBlock);
        document.getElementById('addButton').addEventListener('click', addBlock);

    document.getElementById('removeButtonTur').addEventListener('click', removeBlockTur);
    document.getElementById('addButtonTur').addEventListener('click', addBlockTur);
    
</script>